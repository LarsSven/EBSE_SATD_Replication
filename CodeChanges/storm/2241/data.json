{
  "url": "https://api.github.com/repos/apache/storm/pulls/2241",
  "id": 132190873,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTMyMTkwODcz",
  "html_url": "https://github.com/apache/storm/pull/2241",
  "diff_url": "https://github.com/apache/storm/pull/2241.diff",
  "patch_url": "https://github.com/apache/storm/pull/2241.patch",
  "issue_url": "https://api.github.com/repos/apache/storm/issues/2241",
  "number": 2241,
  "state": "closed",
  "locked": false,
  "title": "STORM-2306 : Messaging subsystem redesign. ",
  "user": {
    "login": "roshannaik",
    "id": 2366541,
    "node_id": "MDQ6VXNlcjIzNjY1NDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2366541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roshannaik",
    "html_url": "https://github.com/roshannaik",
    "followers_url": "https://api.github.com/users/roshannaik/followers",
    "following_url": "https://api.github.com/users/roshannaik/following{/other_user}",
    "gists_url": "https://api.github.com/users/roshannaik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roshannaik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roshannaik/subscriptions",
    "organizations_url": "https://api.github.com/users/roshannaik/orgs",
    "repos_url": "https://api.github.com/users/roshannaik/repos",
    "events_url": "https://api.github.com/users/roshannaik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roshannaik/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "Having spent a lot of time on this, I am happy to share some good news and some even better news with you. \r\n\r\nBefore venturing further, I must add, to limit the scope of this PR, no attempt was made to improve ACK-ing mode perf. Although there are some big latency gains seen in ACK mode, these are a side effect of the new messaging design and work remains to be done to improve ACK mode.   \r\n\r\nPlease see the design docs posted on the STORM-2306 jira for details on what is being done\r\n\r\nSo, first the good news .. a quick competitive evaluation:\r\n\r\n# 1) Competitive Perf evaluation : \r\n\r\nHere are some quick comparison of Storm numbers taken on my laptop against numbers for similar/identical topologies published by Heron, Flink and Apex. Shall provide just rolled up summary here and leave the detailed analysis for later.\r\n\r\nStorm numbers here were run on my MacBook Pro (2015) with 16GB ram and a single 4 core Intel i7 chip.\r\n\r\n\r\n### A) Compared To Heron and Flink:\r\n------------------------------\r\n Heron recently published this blog about the big perf improvements (~4-6x) they achieved.\r\nhttps://blog.twitter.com/engineering/en_us/topics/open-source/2017/optimizing-twitter-heron.html\r\nThey ran it on dual 12-core Intel Xeon chips (didn't say how many machines).\r\n\r\nThey use a simplified word count topology that I have emulated for comparison purposes and included it as part of this PR (SimplifiedWordCountTopo).\r\n\r\nFlink also publishes numbers for a similar setup here \r\nhttps://flink.apache.org/features.html#streaming\r\n\r\nBelow are per core throughput numbers.\r\n\r\n**[:HERON:]**\r\nAcking Disabled: per core = **~475 k/sec**.\r\nAcking Enabled:  per core = **~150 k/sec**. Latency = **30ms**\r\n\r\n**[:FLINK:]**\r\nPer core: **~1 mill/sec**\r\n\r\n**[:STORM:]**\r\nAcking Disabled: per core =   **2 mill/sec.**    (1 spout & 1 counter bolt)\r\nAcking Enabled:  per core = **0.6 mill/sec**, Latency = **0.73 ms**  (+1 acker)\r\n\r\n\r\n**Takeaways:** \r\n- Storm's with-ACK throughput is better than Heron's no-ACK throughput. \r\n- Without ACKs, Storm is far ahead of Heron and also better than Flink. \r\n- Storm's Latency (in microseconds) is also significantly better than both (although this metric is better to compared with multiple machines in the run). AFAIKT, Flink is generally not known for having good latency (as per Flink's own comparison with Storm -  https://data-artisans.com/blog/high-throughput-low-latency-and-exactly-once-stream-processing-with-apache-flink).\r\n\r\n\r\n\r\n### B) Compared to Apex:\r\n-----------------------------------\r\nApex appears to be the best performer among the opensource lot.. by a reasonably good margin. Some numbers they published in their early days (when it was called DataTorrent) were misleading/dubious IMO, but the newer numbers appear credible.\r\n\r\nHere we look at how fast inter spout/bolt communication can be achieved using an ultra minimalist topology.\r\nA ConstSpout emits a short string to a DevNull bolt that discards the tuples it receives. This topo has been in storm-perf for sometime now.\r\n\r\nApex provides numbers for a identical setup ... what they call \"container local\" performance here:\r\nhttps://www.datatorrent.com/blog/blog-apex-performance-benchmark/\r\n\r\nOther than the fact that Storm numbers were on my laptop, these numbers are a good apples to apples comparison.\r\n\r\n**[:APEX:]**\r\nContainer local Throughput : **~4.2 mill/sec**\r\n\r\n**[:STORM:]**\r\nWorker local throughput : **8.1 mill/sec**\r\n\r\n\r\n\r\n# 2) Core messaging Performance\r\n\r\nNow for the better news. The redesigned messaging system is actually much faster and able to move messages between threads at an astounding rate .... :\r\n\r\n- **120 mill/sec**  (batchSz=1000, 2 producers writing to 1 consumer).\r\n- **67 mill/sec**   (batchSz=1000, 1 producers writing to 1 consumer).\r\n\r\n\r\nI have included JCQueuePerfTest.java in this PR to help get quick measurements from within the IDE.\r\n\r\nThat naturally begs the question .. why is Storm pushing only 8.1 mill/sec between a ConstSpout and DevNullBolt ? The short answer is ... there are big bottlenecks in other parts of the code. In this PR I have tackled some such bottlenecks but many still remain. We are faster than the competition, but still have room to be much much faster. If anyone is interested in pursuing these to push Storm's perf to the next level, I am happy to point them in the right direction.\r\n\r\n\r\nAgain, please refer to the design docs in the JIRA for details on the new design and the rationale behind them.\r\n\r\n",
  "created_at": "2017-07-25T03:48:50Z",
  "updated_at": "2018-01-05T04:20:49Z",
  "closed_at": "2018-01-05T04:20:49Z",
  "merged_at": null,
  "merge_commit_sha": "da10a6ebcfff1b1777b6472a96e8399c3cdf20c4",
  "assignee": null,
  "assignees": [],
  "requested_reviewers": [],
  "requested_teams": [],
  "labels": [],
  "milestone": null,
  "draft": false,
  "commits_url": "https://api.github.com/repos/apache/storm/pulls/2241/commits",
  "review_comments_url": "https://api.github.com/repos/apache/storm/pulls/2241/comments",
  "review_comment_url": "https://api.github.com/repos/apache/storm/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/apache/storm/issues/2241/comments",
  "statuses_url": "https://api.github.com/repos/apache/storm/statuses/0edc25044e7666662330dca1b5dfd0da3c8393d8",
  "head": {
    "label": "roshannaik:STORM-2306m",
    "ref": "STORM-2306m",
    "sha": "0edc25044e7666662330dca1b5dfd0da3c8393d8",
    "user": {
      "login": "roshannaik",
      "id": 2366541,
      "node_id": "MDQ6VXNlcjIzNjY1NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2366541?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roshannaik",
      "html_url": "https://github.com/roshannaik",
      "followers_url": "https://api.github.com/users/roshannaik/followers",
      "following_url": "https://api.github.com/users/roshannaik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roshannaik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roshannaik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roshannaik/subscriptions",
      "organizations_url": "https://api.github.com/users/roshannaik/orgs",
      "repos_url": "https://api.github.com/users/roshannaik/repos",
      "events_url": "https://api.github.com/users/roshannaik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roshannaik/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 45638597,
      "node_id": "MDEwOlJlcG9zaXRvcnk0NTYzODU5Nw==",
      "name": "storm",
      "full_name": "roshannaik/storm",
      "private": false,
      "owner": {
        "login": "roshannaik",
        "id": 2366541,
        "node_id": "MDQ6VXNlcjIzNjY1NDE=",
        "avatar_url": "https://avatars.githubusercontent.com/u/2366541?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/roshannaik",
        "html_url": "https://github.com/roshannaik",
        "followers_url": "https://api.github.com/users/roshannaik/followers",
        "following_url": "https://api.github.com/users/roshannaik/following{/other_user}",
        "gists_url": "https://api.github.com/users/roshannaik/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/roshannaik/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/roshannaik/subscriptions",
        "organizations_url": "https://api.github.com/users/roshannaik/orgs",
        "repos_url": "https://api.github.com/users/roshannaik/repos",
        "events_url": "https://api.github.com/users/roshannaik/events{/privacy}",
        "received_events_url": "https://api.github.com/users/roshannaik/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/roshannaik/storm",
      "description": "Mirror of Apache Storm",
      "fork": true,
      "url": "https://api.github.com/repos/roshannaik/storm",
      "forks_url": "https://api.github.com/repos/roshannaik/storm/forks",
      "keys_url": "https://api.github.com/repos/roshannaik/storm/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/roshannaik/storm/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/roshannaik/storm/teams",
      "hooks_url": "https://api.github.com/repos/roshannaik/storm/hooks",
      "issue_events_url": "https://api.github.com/repos/roshannaik/storm/issues/events{/number}",
      "events_url": "https://api.github.com/repos/roshannaik/storm/events",
      "assignees_url": "https://api.github.com/repos/roshannaik/storm/assignees{/user}",
      "branches_url": "https://api.github.com/repos/roshannaik/storm/branches{/branch}",
      "tags_url": "https://api.github.com/repos/roshannaik/storm/tags",
      "blobs_url": "https://api.github.com/repos/roshannaik/storm/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/roshannaik/storm/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/roshannaik/storm/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/roshannaik/storm/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/roshannaik/storm/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/roshannaik/storm/languages",
      "stargazers_url": "https://api.github.com/repos/roshannaik/storm/stargazers",
      "contributors_url": "https://api.github.com/repos/roshannaik/storm/contributors",
      "subscribers_url": "https://api.github.com/repos/roshannaik/storm/subscribers",
      "subscription_url": "https://api.github.com/repos/roshannaik/storm/subscription",
      "commits_url": "https://api.github.com/repos/roshannaik/storm/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/roshannaik/storm/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/roshannaik/storm/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/roshannaik/storm/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/roshannaik/storm/contents/{+path}",
      "compare_url": "https://api.github.com/repos/roshannaik/storm/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/roshannaik/storm/merges",
      "archive_url": "https://api.github.com/repos/roshannaik/storm/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/roshannaik/storm/downloads",
      "issues_url": "https://api.github.com/repos/roshannaik/storm/issues{/number}",
      "pulls_url": "https://api.github.com/repos/roshannaik/storm/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/roshannaik/storm/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/roshannaik/storm/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/roshannaik/storm/labels{/name}",
      "releases_url": "https://api.github.com/repos/roshannaik/storm/releases{/id}",
      "deployments_url": "https://api.github.com/repos/roshannaik/storm/deployments",
      "created_at": "2015-11-05T20:51:37Z",
      "updated_at": "2016-01-14T19:45:21Z",
      "pushed_at": "2020-05-18T19:56:14Z",
      "git_url": "git://github.com/roshannaik/storm.git",
      "ssh_url": "git@github.com:roshannaik/storm.git",
      "clone_url": "https://github.com/roshannaik/storm.git",
      "svn_url": "https://github.com/roshannaik/storm",
      "homepage": null,
      "size": 175484,
      "stargazers_count": 0,
      "watchers_count": 0,
      "language": "Java",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "has_discussions": false,
      "forks_count": 1,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 2,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [],
      "visibility": "public",
      "forks": 1,
      "open_issues": 2,
      "watchers": 0,
      "default_branch": "master"
    }
  },
  "base": {
    "label": "apache:master",
    "ref": "master",
    "sha": "a894fe63a0814719634fab78783079bbcd121735",
    "user": {
      "login": "apache",
      "id": 47359,
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ3MzU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apache",
      "html_url": "https://github.com/apache",
      "followers_url": "https://api.github.com/users/apache/followers",
      "following_url": "https://api.github.com/users/apache/following{/other_user}",
      "gists_url": "https://api.github.com/users/apache/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apache/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apache/subscriptions",
      "organizations_url": "https://api.github.com/users/apache/orgs",
      "repos_url": "https://api.github.com/users/apache/repos",
      "events_url": "https://api.github.com/users/apache/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apache/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 14135470,
      "node_id": "MDEwOlJlcG9zaXRvcnkxNDEzNTQ3MA==",
      "name": "storm",
      "full_name": "apache/storm",
      "private": false,
      "owner": {
        "login": "apache",
        "id": 47359,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ3MzU5",
        "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apache",
        "html_url": "https://github.com/apache",
        "followers_url": "https://api.github.com/users/apache/followers",
        "following_url": "https://api.github.com/users/apache/following{/other_user}",
        "gists_url": "https://api.github.com/users/apache/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/apache/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/apache/subscriptions",
        "organizations_url": "https://api.github.com/users/apache/orgs",
        "repos_url": "https://api.github.com/users/apache/repos",
        "events_url": "https://api.github.com/users/apache/events{/privacy}",
        "received_events_url": "https://api.github.com/users/apache/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/apache/storm",
      "description": "Mirror of Apache Storm",
      "fork": false,
      "url": "https://api.github.com/repos/apache/storm",
      "forks_url": "https://api.github.com/repos/apache/storm/forks",
      "keys_url": "https://api.github.com/repos/apache/storm/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/apache/storm/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/apache/storm/teams",
      "hooks_url": "https://api.github.com/repos/apache/storm/hooks",
      "issue_events_url": "https://api.github.com/repos/apache/storm/issues/events{/number}",
      "events_url": "https://api.github.com/repos/apache/storm/events",
      "assignees_url": "https://api.github.com/repos/apache/storm/assignees{/user}",
      "branches_url": "https://api.github.com/repos/apache/storm/branches{/branch}",
      "tags_url": "https://api.github.com/repos/apache/storm/tags",
      "blobs_url": "https://api.github.com/repos/apache/storm/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/apache/storm/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/apache/storm/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/apache/storm/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/apache/storm/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/apache/storm/languages",
      "stargazers_url": "https://api.github.com/repos/apache/storm/stargazers",
      "contributors_url": "https://api.github.com/repos/apache/storm/contributors",
      "subscribers_url": "https://api.github.com/repos/apache/storm/subscribers",
      "subscription_url": "https://api.github.com/repos/apache/storm/subscription",
      "commits_url": "https://api.github.com/repos/apache/storm/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/apache/storm/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/apache/storm/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/apache/storm/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/apache/storm/contents/{+path}",
      "compare_url": "https://api.github.com/repos/apache/storm/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/apache/storm/merges",
      "archive_url": "https://api.github.com/repos/apache/storm/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/apache/storm/downloads",
      "issues_url": "https://api.github.com/repos/apache/storm/issues{/number}",
      "pulls_url": "https://api.github.com/repos/apache/storm/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/apache/storm/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/apache/storm/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/apache/storm/labels{/name}",
      "releases_url": "https://api.github.com/repos/apache/storm/releases{/id}",
      "deployments_url": "https://api.github.com/repos/apache/storm/deployments",
      "created_at": "2013-11-05T08:00:14Z",
      "updated_at": "2022-12-26T19:40:31Z",
      "pushed_at": "2022-12-26T02:05:52Z",
      "git_url": "git://github.com/apache/storm.git",
      "ssh_url": "git@github.com:apache/storm.git",
      "clone_url": "https://github.com/apache/storm.git",
      "svn_url": "https://github.com/apache/storm",
      "homepage": null,
      "size": 206208,
      "stargazers_count": 6412,
      "watchers_count": 6412,
      "language": "Java",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": true,
      "has_discussions": false,
      "forks_count": 4091,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 60,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [
        "big-data",
        "java",
        "storm"
      ],
      "visibility": "public",
      "forks": 4091,
      "open_issues": 60,
      "watchers": 6412,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/apache/storm/pulls/2241"
    },
    "html": {
      "href": "https://github.com/apache/storm/pull/2241"
    },
    "issue": {
      "href": "https://api.github.com/repos/apache/storm/issues/2241"
    },
    "comments": {
      "href": "https://api.github.com/repos/apache/storm/issues/2241/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/apache/storm/pulls/2241/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/apache/storm/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/apache/storm/pulls/2241/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/apache/storm/statuses/0edc25044e7666662330dca1b5dfd0da3c8393d8"
    }
  },
  "author_association": "CONTRIBUTOR",
  "auto_merge": null,
  "active_lock_reason": null,
  "merged": false,
  "mergeable": false,
  "rebaseable": false,
  "mergeable_state": "dirty",
  "merged_by": null,
  "comments": 71,
  "review_comments": 246,
  "maintainer_can_modify": false,
  "commits": 34,
  "additions": 4625,
  "deletions": 2482,
  "changed_files": 131
}