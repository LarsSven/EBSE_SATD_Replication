{
  "url": "https://api.github.com/repos/apache/spark/pulls/20923",
  "id": 178119296,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTc4MTE5Mjk2",
  "html_url": "https://github.com/apache/spark/pull/20923",
  "diff_url": "https://github.com/apache/spark/pull/20923.diff",
  "patch_url": "https://github.com/apache/spark/pull/20923.patch",
  "issue_url": "https://api.github.com/repos/apache/spark/issues/20923",
  "number": 20923,
  "state": "closed",
  "locked": false,
  "title": "[SPARK-23807][BUILD] Add Hadoop 3.1 profile with relevant POM fix ups",
  "user": {
    "login": "steveloughran",
    "id": 162090,
    "node_id": "MDQ6VXNlcjE2MjA5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/162090?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/steveloughran",
    "html_url": "https://github.com/steveloughran",
    "followers_url": "https://api.github.com/users/steveloughran/followers",
    "following_url": "https://api.github.com/users/steveloughran/following{/other_user}",
    "gists_url": "https://api.github.com/users/steveloughran/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/steveloughran/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/steveloughran/subscriptions",
    "organizations_url": "https://api.github.com/users/steveloughran/orgs",
    "repos_url": "https://api.github.com/users/steveloughran/repos",
    "events_url": "https://api.github.com/users/steveloughran/events{/privacy}",
    "received_events_url": "https://api.github.com/users/steveloughran/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "## What changes were proposed in this pull request?\r\n\r\n1. Adds a `hadoop-3.1` profile build depending on the hadoop-3.1 artifacts.\r\n1. In the hadoop-cloud module, adds an explicit hadoop-3.1 profile which switches from explicitly pulling in cloud connectors (hadoop-openstack, hadoop-aws, hadoop-azure) to depending on the hadoop-cloudstorage POM artifact, which pulls these in, has pre-excluded things like hadoop-common, and stays up to date with new connectors (hadoop-azuredatalake, hadoop-allyun). Goal: it becomes the Hadoop projects homework of keeping this clean, and the spark project doesn't need to handle new hadoop releases adding more dependencies.\r\n1. the hadoop-cloud/hadoop-3.1 profile also declares support for jetty-ajax and jetty-util to ensure that these jars get into the distribution jar directory when needed by unshaded libraries.\r\n1. Increases the curator and zookeeper versions to match those in hadoop-3, fixing spark core to build in sbt with the hadoop-3 dependencies.\r\n\r\n## How was this patch tested?\r\n\r\n* Everything this has been built and tested against both ASF Hadoop branch-3.1 and hadoop trunk.\r\n* spark-shell was used to create connectors to all the stores and verify that file IO could take place. \r\n\r\n\r\nThe spark hive-1.2.1 JAR has problems here, as it's version check logic fails for Hadoop versions > 2.\r\n\r\nThis can be avoided with either of\r\n\r\n* The hadoop JARs built to declare their version as Hadoop 2.11  `mvn install -DskipTests -DskipShade -Ddeclared.hadoop.version=2.11` . This is safe for local test runs, not for deployment (HDFS is very strict about cross-version deployment).\r\n* A modified version of spark hive whose version check switch statement is happy with hadoop 3.\r\n\r\nI've done both, with maven and SBT. \r\n\r\n\r\nThree issues surfaced\r\n\r\n1. A spark-core test failure \u2014fixed in SPARK-23787. \r\n1. SBT only: Zookeeper not being found in spark-core. Somehow curator 2.12.0 triggers some slightly different dependency resolution logic from previous versions, and Ivy was missing zookeeper.jar entirely. This patch adds the explicit declaration for all spark profiles, setting the ZK version = 3.4.9 for hadoop-3.1\r\n1. Marking jetty-utils as provided in spark was stopping hadoop-azure from being able to instantiate the azure wasb:// client; it was using jetty-util-ajax, which could then not find a class in jetty-util. \r\n",
  "created_at": "2018-03-28T18:08:57Z",
  "updated_at": "2020-04-14T16:46:52Z",
  "closed_at": "2018-04-24T17:02:10Z",
  "merged_at": null,
  "merge_commit_sha": "9c4c9e184f92211197487cf3bc7f449e64bf6727",
  "assignee": null,
  "assignees": [],
  "requested_reviewers": [],
  "requested_teams": [],
  "labels": [],
  "milestone": null,
  "draft": false,
  "commits_url": "https://api.github.com/repos/apache/spark/pulls/20923/commits",
  "review_comments_url": "https://api.github.com/repos/apache/spark/pulls/20923/comments",
  "review_comment_url": "https://api.github.com/repos/apache/spark/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/apache/spark/issues/20923/comments",
  "statuses_url": "https://api.github.com/repos/apache/spark/statuses/f6b9dc83d56c20d887166ddba7a7b876a57d65cb",
  "head": {
    "label": "steveloughran:cloud/SPARK-23807-hadoop-31",
    "ref": "cloud/SPARK-23807-hadoop-31",
    "sha": "f6b9dc83d56c20d887166ddba7a7b876a57d65cb",
    "user": {
      "login": "steveloughran",
      "id": 162090,
      "node_id": "MDQ6VXNlcjE2MjA5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/162090?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/steveloughran",
      "html_url": "https://github.com/steveloughran",
      "followers_url": "https://api.github.com/users/steveloughran/followers",
      "following_url": "https://api.github.com/users/steveloughran/following{/other_user}",
      "gists_url": "https://api.github.com/users/steveloughran/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/steveloughran/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/steveloughran/subscriptions",
      "organizations_url": "https://api.github.com/users/steveloughran/orgs",
      "repos_url": "https://api.github.com/users/steveloughran/repos",
      "events_url": "https://api.github.com/users/steveloughran/events{/privacy}",
      "received_events_url": "https://api.github.com/users/steveloughran/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 32387210,
      "node_id": "MDEwOlJlcG9zaXRvcnkzMjM4NzIxMA==",
      "name": "spark",
      "full_name": "steveloughran/spark",
      "private": false,
      "owner": {
        "login": "steveloughran",
        "id": 162090,
        "node_id": "MDQ6VXNlcjE2MjA5MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/162090?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/steveloughran",
        "html_url": "https://github.com/steveloughran",
        "followers_url": "https://api.github.com/users/steveloughran/followers",
        "following_url": "https://api.github.com/users/steveloughran/following{/other_user}",
        "gists_url": "https://api.github.com/users/steveloughran/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/steveloughran/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/steveloughran/subscriptions",
        "organizations_url": "https://api.github.com/users/steveloughran/orgs",
        "repos_url": "https://api.github.com/users/steveloughran/repos",
        "events_url": "https://api.github.com/users/steveloughran/events{/privacy}",
        "received_events_url": "https://api.github.com/users/steveloughran/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/steveloughran/spark",
      "description": "Mirror of Apache Spark",
      "fork": true,
      "url": "https://api.github.com/repos/steveloughran/spark",
      "forks_url": "https://api.github.com/repos/steveloughran/spark/forks",
      "keys_url": "https://api.github.com/repos/steveloughran/spark/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/steveloughran/spark/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/steveloughran/spark/teams",
      "hooks_url": "https://api.github.com/repos/steveloughran/spark/hooks",
      "issue_events_url": "https://api.github.com/repos/steveloughran/spark/issues/events{/number}",
      "events_url": "https://api.github.com/repos/steveloughran/spark/events",
      "assignees_url": "https://api.github.com/repos/steveloughran/spark/assignees{/user}",
      "branches_url": "https://api.github.com/repos/steveloughran/spark/branches{/branch}",
      "tags_url": "https://api.github.com/repos/steveloughran/spark/tags",
      "blobs_url": "https://api.github.com/repos/steveloughran/spark/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/steveloughran/spark/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/steveloughran/spark/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/steveloughran/spark/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/steveloughran/spark/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/steveloughran/spark/languages",
      "stargazers_url": "https://api.github.com/repos/steveloughran/spark/stargazers",
      "contributors_url": "https://api.github.com/repos/steveloughran/spark/contributors",
      "subscribers_url": "https://api.github.com/repos/steveloughran/spark/subscribers",
      "subscription_url": "https://api.github.com/repos/steveloughran/spark/subscription",
      "commits_url": "https://api.github.com/repos/steveloughran/spark/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/steveloughran/spark/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/steveloughran/spark/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/steveloughran/spark/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/steveloughran/spark/contents/{+path}",
      "compare_url": "https://api.github.com/repos/steveloughran/spark/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/steveloughran/spark/merges",
      "archive_url": "https://api.github.com/repos/steveloughran/spark/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/steveloughran/spark/downloads",
      "issues_url": "https://api.github.com/repos/steveloughran/spark/issues{/number}",
      "pulls_url": "https://api.github.com/repos/steveloughran/spark/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/steveloughran/spark/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/steveloughran/spark/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/steveloughran/spark/labels{/name}",
      "releases_url": "https://api.github.com/repos/steveloughran/spark/releases{/id}",
      "deployments_url": "https://api.github.com/repos/steveloughran/spark/deployments",
      "created_at": "2015-03-17T10:36:33Z",
      "updated_at": "2021-11-18T15:23:12Z",
      "pushed_at": "2022-12-23T14:29:43Z",
      "git_url": "git://github.com/steveloughran/spark.git",
      "ssh_url": "git@github.com:steveloughran/spark.git",
      "clone_url": "https://github.com/steveloughran/spark.git",
      "svn_url": "https://github.com/steveloughran/spark",
      "homepage": null,
      "size": 403375,
      "stargazers_count": 1,
      "watchers_count": 1,
      "language": "Scala",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "has_discussions": false,
      "forks_count": 2,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 0,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [],
      "visibility": "public",
      "forks": 2,
      "open_issues": 0,
      "watchers": 1,
      "default_branch": "master"
    }
  },
  "base": {
    "label": "apache:master",
    "ref": "master",
    "sha": "b2329fb1fcdc0e93c4bdc39d574cde7328ef6094",
    "user": {
      "login": "apache",
      "id": 47359,
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ3MzU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apache",
      "html_url": "https://github.com/apache",
      "followers_url": "https://api.github.com/users/apache/followers",
      "following_url": "https://api.github.com/users/apache/following{/other_user}",
      "gists_url": "https://api.github.com/users/apache/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apache/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apache/subscriptions",
      "organizations_url": "https://api.github.com/users/apache/orgs",
      "repos_url": "https://api.github.com/users/apache/repos",
      "events_url": "https://api.github.com/users/apache/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apache/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 17165658,
      "node_id": "MDEwOlJlcG9zaXRvcnkxNzE2NTY1OA==",
      "name": "spark",
      "full_name": "apache/spark",
      "private": false,
      "owner": {
        "login": "apache",
        "id": 47359,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ3MzU5",
        "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apache",
        "html_url": "https://github.com/apache",
        "followers_url": "https://api.github.com/users/apache/followers",
        "following_url": "https://api.github.com/users/apache/following{/other_user}",
        "gists_url": "https://api.github.com/users/apache/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/apache/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/apache/subscriptions",
        "organizations_url": "https://api.github.com/users/apache/orgs",
        "repos_url": "https://api.github.com/users/apache/repos",
        "events_url": "https://api.github.com/users/apache/events{/privacy}",
        "received_events_url": "https://api.github.com/users/apache/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/apache/spark",
      "description": "Apache Spark - A unified analytics engine for large-scale data processing",
      "fork": false,
      "url": "https://api.github.com/repos/apache/spark",
      "forks_url": "https://api.github.com/repos/apache/spark/forks",
      "keys_url": "https://api.github.com/repos/apache/spark/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/apache/spark/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/apache/spark/teams",
      "hooks_url": "https://api.github.com/repos/apache/spark/hooks",
      "issue_events_url": "https://api.github.com/repos/apache/spark/issues/events{/number}",
      "events_url": "https://api.github.com/repos/apache/spark/events",
      "assignees_url": "https://api.github.com/repos/apache/spark/assignees{/user}",
      "branches_url": "https://api.github.com/repos/apache/spark/branches{/branch}",
      "tags_url": "https://api.github.com/repos/apache/spark/tags",
      "blobs_url": "https://api.github.com/repos/apache/spark/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/apache/spark/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/apache/spark/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/apache/spark/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/apache/spark/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/apache/spark/languages",
      "stargazers_url": "https://api.github.com/repos/apache/spark/stargazers",
      "contributors_url": "https://api.github.com/repos/apache/spark/contributors",
      "subscribers_url": "https://api.github.com/repos/apache/spark/subscribers",
      "subscription_url": "https://api.github.com/repos/apache/spark/subscription",
      "commits_url": "https://api.github.com/repos/apache/spark/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/apache/spark/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/apache/spark/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/apache/spark/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/apache/spark/contents/{+path}",
      "compare_url": "https://api.github.com/repos/apache/spark/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/apache/spark/merges",
      "archive_url": "https://api.github.com/repos/apache/spark/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/apache/spark/downloads",
      "issues_url": "https://api.github.com/repos/apache/spark/issues{/number}",
      "pulls_url": "https://api.github.com/repos/apache/spark/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/apache/spark/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/apache/spark/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/apache/spark/labels{/name}",
      "releases_url": "https://api.github.com/repos/apache/spark/releases{/id}",
      "deployments_url": "https://api.github.com/repos/apache/spark/deployments",
      "created_at": "2014-02-25T08:00:08Z",
      "updated_at": "2022-12-27T00:03:36Z",
      "pushed_at": "2022-12-26T23:10:31Z",
      "git_url": "git://github.com/apache/spark.git",
      "ssh_url": "git@github.com:apache/spark.git",
      "clone_url": "https://github.com/apache/spark.git",
      "svn_url": "https://github.com/apache/spark",
      "homepage": "https://spark.apache.org/",
      "size": 451536,
      "stargazers_count": 34618,
      "watchers_count": 34618,
      "language": "Scala",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "has_discussions": false,
      "forks_count": 26430,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 208,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [
        "big-data",
        "java",
        "jdbc",
        "python",
        "r",
        "scala",
        "spark",
        "sql"
      ],
      "visibility": "public",
      "forks": 26430,
      "open_issues": 208,
      "watchers": 34618,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/apache/spark/pulls/20923"
    },
    "html": {
      "href": "https://github.com/apache/spark/pull/20923"
    },
    "issue": {
      "href": "https://api.github.com/repos/apache/spark/issues/20923"
    },
    "comments": {
      "href": "https://api.github.com/repos/apache/spark/issues/20923/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/apache/spark/pulls/20923/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/apache/spark/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/apache/spark/pulls/20923/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/apache/spark/statuses/f6b9dc83d56c20d887166ddba7a7b876a57d65cb"
    }
  },
  "author_association": "CONTRIBUTOR",
  "auto_merge": null,
  "active_lock_reason": null,
  "merged": false,
  "mergeable": null,
  "rebaseable": null,
  "mergeable_state": "unknown",
  "merged_by": null,
  "comments": 37,
  "review_comments": 26,
  "maintainer_can_modify": false,
  "commits": 9,
  "additions": 327,
  "deletions": 1,
  "changed_files": 6
}