{
  "url": "https://api.github.com/repos/apache/flink/pulls/879",
  "id": 38989927,
  "node_id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODk5Mjc=",
  "html_url": "https://github.com/apache/flink/pull/879",
  "diff_url": "https://github.com/apache/flink/pull/879.diff",
  "patch_url": "https://github.com/apache/flink/pull/879.patch",
  "issue_url": "https://api.github.com/repos/apache/flink/issues/879",
  "number": 879,
  "state": "closed",
  "locked": false,
  "title": "[FLINK-1967] Introduce (Event)time in Streaming",
  "user": {
    "login": "aljoscha",
    "id": 68551,
    "node_id": "MDQ6VXNlcjY4NTUx",
    "avatar_url": "https://avatars.githubusercontent.com/u/68551?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aljoscha",
    "html_url": "https://github.com/aljoscha",
    "followers_url": "https://api.github.com/users/aljoscha/followers",
    "following_url": "https://api.github.com/users/aljoscha/following{/other_user}",
    "gists_url": "https://api.github.com/users/aljoscha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aljoscha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aljoscha/subscriptions",
    "organizations_url": "https://api.github.com/users/aljoscha/orgs",
    "repos_url": "https://api.github.com/users/aljoscha/repos",
    "events_url": "https://api.github.com/users/aljoscha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aljoscha/received_events",
    "type": "User",
    "site_admin": false
  },
  "body": "(This PR consists of other commits because of bugs discovered while writing tests for the new feature and existing features.)\n\nThis is the first step towards supporting proper event-time windowing.\n## [FLINK-1967] Introduce (Event)time in Streaming\n\nThis introduces an additional timestamp field in StreamRecord of type\norg.joda.time.Instant. When using a SourceFunction, the timestamp is\nautomatically set to Instant.now() upon element emission. The timestamp\ncan be manually set using a ManualTimestampSourceFunction.\n\nThis also changes the signature of the StreamOperators. They now get\na StreamRecord instead of the unwrapped value. This is necessary for\nthem to access the timestamp. Before, the StreamTask would unwrap the\nvalue from the StreamRecord, now this is moved one layer higher.\n\nThis also introduces watermarks to keep track of processing. At\na configurable interval the sources will emit watermarks that signify\nthat no records with a lower timestamp will be emitted in the future by\nthis source. The timestamps are broadcast, stream inputs wait for watermark\nevents on all input channels and forward the watermark to the\nStreamOperator once the watermark advances on all inputs. Operators are\nresponsible for forwarding the watermark once they know that no elements\nwith a previous timestamp will be emitted (this is mostly relevant for\nbuffering operations such as windows). Right now, all operators simply\nforward the watermark they receive.\n\nWhen using a ManualTimestampSourceFunction the system does not\nautomatically emit timestamps, the user is required to manually emit\nwatermarks using the SourceContext.\n\nNo watermarks will be emitted unless\nExecutionConfig.setAutoWatermarkInterval is used to set a watermark\ninterval.\n## [FLINK-2290/2295] Fix CoReader Event Handling and Checkpointing\n\nThis changes CoReader (now CoStreamingRecordReader) to reuse\nUnionGate for the input multiplexing. This way it will not lock in on\none specific input side and read events from both input sides.\n\nThis also enables an event listener for checkpoint barriers so that the\nTwoInputTask now reacts to those and correctly forwards them.\n\nThen, this adds CoStreamCheckpointintITCase to verify that checkpointing\nworks in topologies with TwoInputStreamTasks.\n\nThis also adds tests for OneInputStreamTask and TwoInputStreamTask\nthat check whether:\n- whether open()/close() of RichFunctions are correctly\n  called\n- Watermarks are correctly forwarded\n- Supersteps/checkpoint barriers are correctly forwarded and the\n  blocking of inputs works correctly\n## Add proper tests for Stream Operators\n\nThese test whether:\n- open()/close() on RichFunctions are called\n- Timestamps of emitted elements match the timestamp of the input\n  element\n- Watermarks are correctly forwarded\n## [FLINK-2301] Fix Behaviour of BarrierBuffer and add Tests\n\nBefore, a CheckpointBarrier from a more recent Checkpoint would also\ntrigger unblocking while waiting on an older CheckpointBarrier. Now,\na CheckpointBarrier from a newer checkpoint will unblock all channels\nand start a new wait on the new Checkpoint.\n\nThe tests for OneInputStreamTask and TwoInputStreamTask check whether\nthe buffer behaves correctly when receiving CheckpointBarriers from more\nrecent checkpoints while still waiting on an older CheckpointBarrier.\n## Performance Testing\n\nTo see what the impact of the changes is I ran this program:\n\n```\nenv\n    .addSource(new TupleSource(numGroups))\n    .groupBy(0)\n    .window(Time.of(5, TimeUnit.SECONDS))\n    .sum(1)\n    .flatten()\n    .writeAsCsv(<blabla>);\n```\n\n`TupleSource` is emitting `(\"group x\", 1)` in a loop. I used a Google Compute Cluster with 3 Workers, DOP=6.\n\nThese are the average number of tuples in a group over a few minutes runtime:\n- master: 1,093,726\n- event-time: 949,541\n- watermark every 500 ms: 887,087\n",
  "created_at": "2015-07-01T14:49:27Z",
  "updated_at": "2019-03-14T16:44:36Z",
  "closed_at": "2015-07-21T10:50:56Z",
  "merged_at": null,
  "merge_commit_sha": "f2c07f4c786fe3395cdea88e8d63ac8bc20fdb17",
  "assignee": null,
  "assignees": [],
  "requested_reviewers": [],
  "requested_teams": [],
  "labels": [
    {
      "id": 1272993074,
      "node_id": "MDU6TGFiZWwxMjcyOTkzMDc0",
      "url": "https://api.github.com/repos/apache/flink/labels/component=%3Cnone%3E",
      "name": "component=<none>",
      "color": "175fb7",
      "default": false,
      "description": null
    }
  ],
  "milestone": null,
  "draft": false,
  "commits_url": "https://api.github.com/repos/apache/flink/pulls/879/commits",
  "review_comments_url": "https://api.github.com/repos/apache/flink/pulls/879/comments",
  "review_comment_url": "https://api.github.com/repos/apache/flink/pulls/comments{/number}",
  "comments_url": "https://api.github.com/repos/apache/flink/issues/879/comments",
  "statuses_url": "https://api.github.com/repos/apache/flink/statuses/c06ce04ec2877bffd111e04bf8f8a415f39ab5e5",
  "head": {
    "label": "aljoscha:event-time",
    "ref": "event-time",
    "sha": "c06ce04ec2877bffd111e04bf8f8a415f39ab5e5",
    "user": {
      "login": "aljoscha",
      "id": 68551,
      "node_id": "MDQ6VXNlcjY4NTUx",
      "avatar_url": "https://avatars.githubusercontent.com/u/68551?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aljoscha",
      "html_url": "https://github.com/aljoscha",
      "followers_url": "https://api.github.com/users/aljoscha/followers",
      "following_url": "https://api.github.com/users/aljoscha/following{/other_user}",
      "gists_url": "https://api.github.com/users/aljoscha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aljoscha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aljoscha/subscriptions",
      "organizations_url": "https://api.github.com/users/aljoscha/orgs",
      "repos_url": "https://api.github.com/users/aljoscha/repos",
      "events_url": "https://api.github.com/users/aljoscha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aljoscha/received_events",
      "type": "User",
      "site_admin": false
    },
    "repo": {
      "id": 22066189,
      "node_id": "MDEwOlJlcG9zaXRvcnkyMjA2NjE4OQ==",
      "name": "flink",
      "full_name": "aljoscha/flink",
      "private": false,
      "owner": {
        "login": "aljoscha",
        "id": 68551,
        "node_id": "MDQ6VXNlcjY4NTUx",
        "avatar_url": "https://avatars.githubusercontent.com/u/68551?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/aljoscha",
        "html_url": "https://github.com/aljoscha",
        "followers_url": "https://api.github.com/users/aljoscha/followers",
        "following_url": "https://api.github.com/users/aljoscha/following{/other_user}",
        "gists_url": "https://api.github.com/users/aljoscha/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/aljoscha/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/aljoscha/subscriptions",
        "organizations_url": "https://api.github.com/users/aljoscha/orgs",
        "repos_url": "https://api.github.com/users/aljoscha/repos",
        "events_url": "https://api.github.com/users/aljoscha/events{/privacy}",
        "received_events_url": "https://api.github.com/users/aljoscha/received_events",
        "type": "User",
        "site_admin": false
      },
      "html_url": "https://github.com/aljoscha/flink",
      "description": "Mirror of Apache Flink",
      "fork": true,
      "url": "https://api.github.com/repos/aljoscha/flink",
      "forks_url": "https://api.github.com/repos/aljoscha/flink/forks",
      "keys_url": "https://api.github.com/repos/aljoscha/flink/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/aljoscha/flink/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/aljoscha/flink/teams",
      "hooks_url": "https://api.github.com/repos/aljoscha/flink/hooks",
      "issue_events_url": "https://api.github.com/repos/aljoscha/flink/issues/events{/number}",
      "events_url": "https://api.github.com/repos/aljoscha/flink/events",
      "assignees_url": "https://api.github.com/repos/aljoscha/flink/assignees{/user}",
      "branches_url": "https://api.github.com/repos/aljoscha/flink/branches{/branch}",
      "tags_url": "https://api.github.com/repos/aljoscha/flink/tags",
      "blobs_url": "https://api.github.com/repos/aljoscha/flink/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/aljoscha/flink/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/aljoscha/flink/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/aljoscha/flink/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/aljoscha/flink/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/aljoscha/flink/languages",
      "stargazers_url": "https://api.github.com/repos/aljoscha/flink/stargazers",
      "contributors_url": "https://api.github.com/repos/aljoscha/flink/contributors",
      "subscribers_url": "https://api.github.com/repos/aljoscha/flink/subscribers",
      "subscription_url": "https://api.github.com/repos/aljoscha/flink/subscription",
      "commits_url": "https://api.github.com/repos/aljoscha/flink/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/aljoscha/flink/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/aljoscha/flink/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/aljoscha/flink/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/aljoscha/flink/contents/{+path}",
      "compare_url": "https://api.github.com/repos/aljoscha/flink/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/aljoscha/flink/merges",
      "archive_url": "https://api.github.com/repos/aljoscha/flink/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/aljoscha/flink/downloads",
      "issues_url": "https://api.github.com/repos/aljoscha/flink/issues{/number}",
      "pulls_url": "https://api.github.com/repos/aljoscha/flink/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/aljoscha/flink/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/aljoscha/flink/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/aljoscha/flink/labels{/name}",
      "releases_url": "https://api.github.com/repos/aljoscha/flink/releases{/id}",
      "deployments_url": "https://api.github.com/repos/aljoscha/flink/deployments",
      "created_at": "2014-07-21T13:51:54Z",
      "updated_at": "2021-12-17T07:18:01Z",
      "pushed_at": "2021-02-25T16:38:29Z",
      "git_url": "git://github.com/aljoscha/flink.git",
      "ssh_url": "git@github.com:aljoscha/flink.git",
      "clone_url": "https://github.com/aljoscha/flink.git",
      "svn_url": "https://github.com/aljoscha/flink",
      "homepage": null,
      "size": 281216,
      "stargazers_count": 0,
      "watchers_count": 0,
      "language": "Java",
      "has_issues": false,
      "has_projects": true,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "has_discussions": false,
      "forks_count": 1,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 0,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [],
      "visibility": "public",
      "forks": 1,
      "open_issues": 0,
      "watchers": 0,
      "default_branch": "master"
    }
  },
  "base": {
    "label": "apache:master",
    "ref": "master",
    "sha": "a9dc4307d9d04dc2864e0b80609a62b4d01f5097",
    "user": {
      "login": "apache",
      "id": 47359,
      "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ3MzU5",
      "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/apache",
      "html_url": "https://github.com/apache",
      "followers_url": "https://api.github.com/users/apache/followers",
      "following_url": "https://api.github.com/users/apache/following{/other_user}",
      "gists_url": "https://api.github.com/users/apache/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/apache/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/apache/subscriptions",
      "organizations_url": "https://api.github.com/users/apache/orgs",
      "repos_url": "https://api.github.com/users/apache/repos",
      "events_url": "https://api.github.com/users/apache/events{/privacy}",
      "received_events_url": "https://api.github.com/users/apache/received_events",
      "type": "Organization",
      "site_admin": false
    },
    "repo": {
      "id": 20587599,
      "node_id": "MDEwOlJlcG9zaXRvcnkyMDU4NzU5OQ==",
      "name": "flink",
      "full_name": "apache/flink",
      "private": false,
      "owner": {
        "login": "apache",
        "id": 47359,
        "node_id": "MDEyOk9yZ2FuaXphdGlvbjQ3MzU5",
        "avatar_url": "https://avatars.githubusercontent.com/u/47359?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/apache",
        "html_url": "https://github.com/apache",
        "followers_url": "https://api.github.com/users/apache/followers",
        "following_url": "https://api.github.com/users/apache/following{/other_user}",
        "gists_url": "https://api.github.com/users/apache/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/apache/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/apache/subscriptions",
        "organizations_url": "https://api.github.com/users/apache/orgs",
        "repos_url": "https://api.github.com/users/apache/repos",
        "events_url": "https://api.github.com/users/apache/events{/privacy}",
        "received_events_url": "https://api.github.com/users/apache/received_events",
        "type": "Organization",
        "site_admin": false
      },
      "html_url": "https://github.com/apache/flink",
      "description": "Apache Flink",
      "fork": false,
      "url": "https://api.github.com/repos/apache/flink",
      "forks_url": "https://api.github.com/repos/apache/flink/forks",
      "keys_url": "https://api.github.com/repos/apache/flink/keys{/key_id}",
      "collaborators_url": "https://api.github.com/repos/apache/flink/collaborators{/collaborator}",
      "teams_url": "https://api.github.com/repos/apache/flink/teams",
      "hooks_url": "https://api.github.com/repos/apache/flink/hooks",
      "issue_events_url": "https://api.github.com/repos/apache/flink/issues/events{/number}",
      "events_url": "https://api.github.com/repos/apache/flink/events",
      "assignees_url": "https://api.github.com/repos/apache/flink/assignees{/user}",
      "branches_url": "https://api.github.com/repos/apache/flink/branches{/branch}",
      "tags_url": "https://api.github.com/repos/apache/flink/tags",
      "blobs_url": "https://api.github.com/repos/apache/flink/git/blobs{/sha}",
      "git_tags_url": "https://api.github.com/repos/apache/flink/git/tags{/sha}",
      "git_refs_url": "https://api.github.com/repos/apache/flink/git/refs{/sha}",
      "trees_url": "https://api.github.com/repos/apache/flink/git/trees{/sha}",
      "statuses_url": "https://api.github.com/repos/apache/flink/statuses/{sha}",
      "languages_url": "https://api.github.com/repos/apache/flink/languages",
      "stargazers_url": "https://api.github.com/repos/apache/flink/stargazers",
      "contributors_url": "https://api.github.com/repos/apache/flink/contributors",
      "subscribers_url": "https://api.github.com/repos/apache/flink/subscribers",
      "subscription_url": "https://api.github.com/repos/apache/flink/subscription",
      "commits_url": "https://api.github.com/repos/apache/flink/commits{/sha}",
      "git_commits_url": "https://api.github.com/repos/apache/flink/git/commits{/sha}",
      "comments_url": "https://api.github.com/repos/apache/flink/comments{/number}",
      "issue_comment_url": "https://api.github.com/repos/apache/flink/issues/comments{/number}",
      "contents_url": "https://api.github.com/repos/apache/flink/contents/{+path}",
      "compare_url": "https://api.github.com/repos/apache/flink/compare/{base}...{head}",
      "merges_url": "https://api.github.com/repos/apache/flink/merges",
      "archive_url": "https://api.github.com/repos/apache/flink/{archive_format}{/ref}",
      "downloads_url": "https://api.github.com/repos/apache/flink/downloads",
      "issues_url": "https://api.github.com/repos/apache/flink/issues{/number}",
      "pulls_url": "https://api.github.com/repos/apache/flink/pulls{/number}",
      "milestones_url": "https://api.github.com/repos/apache/flink/milestones{/number}",
      "notifications_url": "https://api.github.com/repos/apache/flink/notifications{?since,all,participating}",
      "labels_url": "https://api.github.com/repos/apache/flink/labels{/name}",
      "releases_url": "https://api.github.com/repos/apache/flink/releases{/id}",
      "deployments_url": "https://api.github.com/repos/apache/flink/deployments",
      "created_at": "2014-06-07T07:00:10Z",
      "updated_at": "2022-12-26T19:40:03Z",
      "pushed_at": "2022-12-26T22:52:46Z",
      "git_url": "git://github.com/apache/flink.git",
      "ssh_url": "git@github.com:apache/flink.git",
      "clone_url": "https://github.com/apache/flink.git",
      "svn_url": "https://github.com/apache/flink",
      "homepage": "",
      "size": 482713,
      "stargazers_count": 20359,
      "watchers_count": 20359,
      "language": "Java",
      "has_issues": false,
      "has_projects": false,
      "has_downloads": true,
      "has_wiki": false,
      "has_pages": false,
      "has_discussions": false,
      "forks_count": 11535,
      "mirror_url": null,
      "archived": false,
      "disabled": false,
      "open_issues_count": 953,
      "license": {
        "key": "apache-2.0",
        "name": "Apache License 2.0",
        "spdx_id": "Apache-2.0",
        "url": "https://api.github.com/licenses/apache-2.0",
        "node_id": "MDc6TGljZW5zZTI="
      },
      "allow_forking": true,
      "is_template": false,
      "web_commit_signoff_required": false,
      "topics": [
        "big-data",
        "flink",
        "java",
        "python",
        "scala",
        "sql"
      ],
      "visibility": "public",
      "forks": 11535,
      "open_issues": 953,
      "watchers": 20359,
      "default_branch": "master"
    }
  },
  "_links": {
    "self": {
      "href": "https://api.github.com/repos/apache/flink/pulls/879"
    },
    "html": {
      "href": "https://github.com/apache/flink/pull/879"
    },
    "issue": {
      "href": "https://api.github.com/repos/apache/flink/issues/879"
    },
    "comments": {
      "href": "https://api.github.com/repos/apache/flink/issues/879/comments"
    },
    "review_comments": {
      "href": "https://api.github.com/repos/apache/flink/pulls/879/comments"
    },
    "review_comment": {
      "href": "https://api.github.com/repos/apache/flink/pulls/comments{/number}"
    },
    "commits": {
      "href": "https://api.github.com/repos/apache/flink/pulls/879/commits"
    },
    "statuses": {
      "href": "https://api.github.com/repos/apache/flink/statuses/c06ce04ec2877bffd111e04bf8f8a415f39ab5e5"
    }
  },
  "author_association": "CONTRIBUTOR",
  "auto_merge": null,
  "active_lock_reason": null,
  "merged": false,
  "mergeable": false,
  "rebaseable": false,
  "mergeable_state": "dirty",
  "merged_by": null,
  "comments": 16,
  "review_comments": 16,
  "maintainer_can_modify": false,
  "commits": 6,
  "additions": 5492,
  "deletions": 1704,
  "changed_files": 135
}